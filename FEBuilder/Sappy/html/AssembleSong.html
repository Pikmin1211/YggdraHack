<html>
<head>
<title>Assemble Song</title>
</head>
<body>

<font size="+1">Assemble Song の拡張について</font>

<p><img src="images/AssembleSong1.png"></p>

<p>Assemble Song 画面はオリジナルとは表示内容が増えています。<br>
オリジナルソースの時点ですでに手が加えられていましたので、そのまま使用し、さらに拡張しています。</p>

Mod 15 より .s ファイルと ROM イメージファイル部分を「テキストボックス＋参照ボタン」から
「参照ボタン兼ファイル名表示欄」に変更しています。</p>

<dl>
<dt>.S file name</dt>
<dd>書き込みたい曲の .S ファイルを指定します。</dd>
<dt>Target .GBA file</dt>
<dd>書き込み先の ROM ファイルを指定します。デフォルトで Sappy で開いているファイル名が自動的に入ります。</dd>
<dt>Base destination offset</dt>
<dd>曲データの書き込み先頭アドレスを指定します。デフォルトで Sappy で開いている曲の先頭アドレスが自動的に入ります。</dd>
<dt>Voicegroup offset</dt>
<dd>使用するボイスグループのアドレスを指定します。デフォルトで Sappy で開いている曲のボイスグループアドレスが自動的に入ります。</dd>
<dt>MST offset</dt>
<dd>書き込みたい曲の曲テーブルアドレスを指定します。
<br />Sappy でファイルを開いた状態であれば、デフォルトで現在の song num （曲番号）が入ります。この場合、その入力欄の右に実際に書き込まれるオフセット値が表示されます。
<br />そうでない場合には書き込むアドレスを直接指定します。</dd>
<dt>Song Group</dt>
<dd>書き込みたい曲の曲グループを指定します。 "1:" と "2:" にそれぞれグループ番号を指定します。通常はどちらも同じ値です。デフォルトで Sappy で開いている曲の曲グループが自動的に入ります。
<br />
<br />※ 曲グループとは、 GBA の演奏機能に実装されている、レイヤー表現のようなものです。例えばポケ○ンシリーズであれば 0 番が BGM 用、 1 番が効果音用というように用途ごとに番号を割り振っています。同じグループの曲データは同時には鳴らせない仕組みになっていますが、グループを正しく指定することで、 BGM に割り込む形で効果音を鳴らすようにしています。
<br />なお、 ROM 上にはグループ番号が2つ入力できますが、 2: 側の用途は不明です。用途がわかっている場合を除き 1: と同じにしておいてください。</dd>
</dl>

<p>Mod 16 より、アセンブラを全面的に刷新しました。<br>
そのために逆に今までエラーが出ていなかったものが、エラーとなる可能性があります。<br>
<b>特に .equ シンボル定義やラベル名に使用できる文字が制限されていますのでご注意ください。</b>

<pre>シンボル(変数)・ラベル名に使用出来る文字
　　A〜Z,a〜z (大文字小文字は区別されます)
　　_ . (半角記号はこの 2 種のみ使用可能です)
　　0〜9 (ただし、２文字目以降)
　　全角文字 (基本すべて使用可能です。)</pre>

<hr>
<p>アセンブル時にエラーがあった場合、以下のようなダイアログが表示されます。</p>
<p><img src="images/AssembleSong2.png"></p>
<br />エラーメッセージは以下の通りです。</p>

<dl>
<dt><font color="#cc0000"><b>.sファイル名</b></font>:<font color="#cc0000"><b>行番号</b></font>: Can't find file <font color="#cc0000"><b>ファイル名</b></font> for inclusion.</dt>
<dd>.include に指定されたファイルが見つかりません。
<br />.s ファイル内で読み込ませるファイル名を確認してください
<br />&nbsp;</dd>
<dt><font color="#cc0000"><b>.sファイル名</b></font>:<font color="#cc0000"><b>行番号</b></font>: Undefined label "<font color="#cc0000"><b>ラベル名</b></font>"</dt>
<dd>.word 命令で指定されたラベル名が見つかりません。
<br />ラベル名が正しいか確認してください。
<br />&nbsp;</dd>
<dt><font color="#cc0000"><b>.sファイル名</b></font>:<font color="#cc0000"><b>行番号</b></font>: unsupported op-code "<font color="#cc0000"><b>命令</b></font>"</dt>
<dd>指定された命令は、Sappy アセンブラでは実装されていません。
<br />正しい命令を書いているか確認してください。
<br />&nbsp;</dd>
<dt>Error #<font color="#cc0000"><b>エラー番号</b></font>, "<font color="#cc0000"><b>エラーメッセージ</b></font>"
<br />（ On line: "<font color="#cc0000"><b>行番号</b></font>:<font color="#cc0000"><b>行内容</b></font>". ）</dt>
<dd>上記以外のエラーです。状態によって2行目も表示されます。
<br />エラーメッセージを確認して、対応してください。
<br />&nbsp;</dd>
</dl>



<p>なお、<font color="#cc0000"><b>エラーが発生した場合でも、その部分までのデータは ROM イメージに書き込まれています</b></font>。
<br />必ずファイルのバックアップをしてから書き込みを行ってください。</p>
</body>
</heml>
